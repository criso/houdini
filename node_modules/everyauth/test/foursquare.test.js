// TODO Need to be able to link * and api.* cookies

var tobi = require('tobi')
  , should = require('should')
  , browser = tobi.createBrowser(3000, 'local.host')
  , creds = require('./creds.js');

// Test a successful login
browser.userAgent = 'Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.30 (KHTML, like Gecko) Chrome/12.0.742.100 Safari/534.30';
browser.get('/auth/foursquare', function (res, $) {
  $('#content form')
    
    // Click Log In
    .submit( function (res, $) {
      res.should.have.status(200);
      $('#loginForm form:first')
        .fill({
            '#username': creds.foursquare.login
          , '#password': creds.foursquare.password })
        .submit(function (res, $) {
          res.should.have.status(200);
          $('h2').should.have.text('Authenticated');
          $('h2').should.not.have.text('Not Authenticated');
        });
    });
});
